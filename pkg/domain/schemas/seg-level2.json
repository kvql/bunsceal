{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/kvql/bunsceal/pkg/domain/schemas/seg-level2.json",
  "title": "SegL2",
  "description": "Segmentation Level 2 definitions, including per-environment overrides",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version identifier"
    },
    "name": {
      "type": "string",
      "minLength": 1
    },
    "id": {
      "$ref": "./common.json#/$defs/sdId"
    },
    "description": {
      "type": "string",
      "minLength": 1
    },
    "l1_parents": {
      "type": "array",
      "description": "Explicit list of L1 parent segment IDs",
      "items": {
        "type": "string",
        "pattern": "^[a-z-]{1,15}$"
      },
      "minItems": 1,
      "uniqueItems": true
    },
    "l1_overrides": {
      "type": "object",
      "description": "Map of L1 segment ID -> L1 override details. Keys must be subset of l1_parents if l1_parents is present.",
      "patternProperties": {
        "^[a-z-]{1,15}$": {
          "$ref": "./l1-overrides.json"
        }
      },
      "minProperties": 0,
      "additionalProperties": false
    },
    "prominence": {
      "type": "integer",
      "description": "variable to increase the size of listed security domains. Value is the number of new lines to add above and below the label. This is used to make the listed L2 Segment more visible in the graph.",
      "enum": [
        1,
        2,
        3
      ]
    },
    "labels": {
      "$ref": "./common.json#/$defs/labels"
    }
  },
  "required": [
    "version",
    "name",
    "id",
    "description"
  ],
  "anyOf": [
    {
      "required": ["l1_parents"],
      "description": "New format: explicit l1_parents field"
    },
    {
      "required": ["l1_overrides"],
      "properties": {
        "l1_overrides": {
          "minProperties": 1
        }
      },
      "description": "Legacy format: l1_overrides with at least one entry"
    }
  ],
  "additionalProperties": false
}
